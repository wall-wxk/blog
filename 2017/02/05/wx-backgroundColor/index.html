<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="wall,前端"><title>微信面试题-获取元素的最终background-color | wall's blog</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">微信面试题-获取元素的最终background-color</h1><a id="logo" href="/.">wall's blog</a><p class="description">努力向上</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">微信面试题-获取元素的最终background-color</h1><div class="post-meta">Feb 5, 2017<span> | </span><span class="category"><a href="/categories/CSS/">CSS</a><a href="/categories/CSS/面试题/">面试题</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/02/05/wx-backgroundColor/" href="/2017/02/05/wx-backgroundColor/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="一、题目"><a href="#一、题目" class="headerlink" title="一、题目"></a>一、题目</h2><p> 用JS代码求出页面上一个元素的最终的background-color，不考虑IE浏览器，不考虑元素float情况。</p>
<h2 id="二、题目解析"><a href="#二、题目解析" class="headerlink" title="二、题目解析"></a>二、题目解析</h2><p> <strong>1.考察底层JavaScript基础</strong><br> 前端开发，日常最常接触的就是页面样式的编写。而摆脱jQuery等工具库，用原生js获取样式，是每个前端程序猿进阶阶段必须掌握的技能。</p>
<p> <strong>2.考察面试者的思维缜密程度和开发经验</strong><br> 如果认为单单求元素计算后的样式，就有点too young了。页面的样式的复杂，永远是最虐心的。就算前端有多牛逼，一听到兼容IE6，论谁都会心塞😓。所以还要考虑特殊的情况：<code>display，opacity，visibility</code>的取值。</p>
<h2 id="三、理论基础"><a href="#三、理论基础" class="headerlink" title="三、理论基础"></a>三、理论基础</h2><p> <strong>1. 内联样式</strong><br> 内联样式可以通过元素的style属性获取，如果style属性有background-color值，则可以直接获取出来 (暂不考虑!important) 。</p>
<p> <strong>2. 外联的层叠样式</strong><br> DOM2样式规范在<code>document.defaultView</code>中包含了一个<code>getComputedStyle()</code>方法。该方法返回一个只读的CSSStyleDeclaration对象，其中包含特定元素的所有计算样式。</p>
<h2 id="四、解题"><a href="#四、解题" class="headerlink" title="四、解题"></a>四、解题</h2><p><strong>4.1 将所有工具方法封装在WDS(wall dom script)命名空间中</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">WDS, undefined</span>)</span>&#123;</div><div class="line">  <span class="comment">// 封装代码...</span></div><div class="line">&#125;)(<span class="built_in">window</span>.WDS || (<span class="built_in">window</span>.WDS = &#123;&#125;));</div></pre></td></tr></table></figure></p>
<p> 代码封装在命名空间里，不会造成无意间的代码污染。</p>
<p><strong>4.2 工具方法camelize</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 字符串转换为驼峰写法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">camelize</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/-(\w)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">strMatch, p1</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> p1.toUpperCase();</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 该方法是为了方便后续<code>getStyle()</code>方法的编写，而独立出来的。<br> 作用是将连字符类的css属性值，转换成驼峰写法。<br> 例如：将background-color转换为backgroundColor</p>
<p><strong>4.3 获取特定元素的计算样式</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取元素计算后的样式</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStyle</span>(<span class="params">elem, property</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(!elem || !property)&#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> value = elem.style[camelize(property)], <span class="comment">// 先获取是否有内联样式</span></div><div class="line">		css; <span class="comment">// 获取的所有计算样式</span></div><div class="line"></div><div class="line">	<span class="comment">// 无内联样式，则获取层叠样式表计算后的样式</span></div><div class="line">	<span class="keyword">if</span>(!value)&#123;</div><div class="line">		<span class="keyword">if</span>(<span class="built_in">document</span>.defaultView &amp;&amp; <span class="built_in">document</span>.defaultView.getComputedStyle)&#123;</div><div class="line">			css = <span class="built_in">document</span>.defaultView.getComputedStyle(elem, <span class="literal">null</span>);</div><div class="line">			value = css ? css.getPropertyValue(property) : <span class="literal">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> value;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 做到这一步，第一个考察点基本就满足了。也能获知面试者是否具备足够扎实的js基础。<br> 另外，像安全保护性的判断<code>if(!elem || !property)</code>和功能嗅探<code>if(document.defaultView &amp;&amp; document.defaultView.getComputedStyle)</code>，都能很好地体现开发者的代码逻辑和开发经验。</p>
<p><strong>4.4 排除特殊情况</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 检测获取的背景色是否有效</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkBgValue</span>(<span class="params">elem</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> value = getStyle(elem, <span class="string">'background-color'</span>),</div><div class="line">		hasColor = value ? <span class="literal">true</span> : <span class="literal">false</span>; <span class="comment">// 是否有颜色</span></div><div class="line"></div><div class="line">	<span class="comment">// 排除特殊情况</span></div><div class="line">	<span class="keyword">if</span>(value == <span class="string">"transparent"</span> || value == <span class="string">"rgba(0, 0, 0, 0)"</span>)&#123;</div><div class="line">		<span class="comment">// 未设置background-color，或者设置为跟随父节点</span></div><div class="line">		hasColor = <span class="literal">false</span>;</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(getStyle(elem, <span class="string">'opacity'</span>) == <span class="string">"0"</span>)&#123;</div><div class="line">		<span class="comment">// dom节点透明度为全透明</span></div><div class="line">		hasColor = <span class="literal">false</span>;</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(getStyle(elem, <span class="string">'visibility'</span>) == <span class="string">"hidden"</span>)&#123;</div><div class="line">		<span class="comment">// dom节点不可见</span></div><div class="line">		hasColor = <span class="literal">false</span>;</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(getStyle(elem, <span class="string">'display'</span>) == <span class="string">"none"</span>)&#123;</div><div class="line">		<span class="comment">// dom节点不可见</span></div><div class="line">		hasColor = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> hasColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>4.5 获取div在页面最终显示的颜色</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取div最终显示的颜色</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRealBg</span>(<span class="params">elem</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(checkBgValue(elem))&#123;</div><div class="line">		<span class="keyword">return</span> getStyle(elem, <span class="string">'background-color'</span>);</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(elem != <span class="built_in">document</span>.documentElement)&#123;</div><div class="line">		<span class="keyword">return</span> getRealBg(elem.parentNode);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="string">''</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 获取样式值采用递归方式处理。<br> 如果能顺利获取到元素样式，且不触发<code>4.4 排除特殊情况</code>中的一种，则直接返回结果。<br> 触发了特殊情况，则需要查找父节点以及更上层的节点的样式，来获取肉眼能看到，显示在页面上的background-color值。<br> 在向上回溯的过程中，如果已经回溯到<code>html</code>根节点，则可以停止回溯。所以加了判断<code>else if(elem != document.documentElement)</code></p>
<h2 id="五、遗漏的大boss"><a href="#五、遗漏的大boss" class="headerlink" title="五、遗漏的大boss"></a>五、遗漏的大boss</h2><p><strong>5.1 大boss !important</strong><br> 如果乱用 <code>!important</code>，对大型项目的维护和开发，绝对是一场噩梦。因为优先级规则的计算，<code>!important</code>永远处在食物链的最顶层。<br> 当前题目不考虑这种情况，也是我的偷懒😆。确实很棘手，就不写这个逻辑分支的代码了。这里提醒一下~</p>
<p><strong>5.2 大boss 父节点及根节点设置了不可见css属性</strong><br> 只要设置该css语句：<code>html {display:none;}</code>，页面所有元素立刻消失不见。而任意特定元素的上级节点，只要设置了 <code>opacity,display,visibility</code>，判断逻辑瞬间变得复杂起来。所以，这个浑水我也不趟 O(∩_∩)O哈哈~</p>
<h2 id="六、改进的点"><a href="#六、改进的点" class="headerlink" title="六、改进的点"></a>六、改进的点</h2><p> 其实特殊情况排除的判断，我偷懒没做到最好——rgb颜色值和特定颜色值(比如red)没有进行统一的转换，只是加了生硬的判断<code>if(value == &quot;transparent&quot; || value == &quot;rgba(0, 0, 0, 0)&quot;)</code>。<br> 有兴趣的可以搜索下颜色值转换的js方法，这里我就不写了。</p>
<h2 id="七、源码和demo"><a href="#七、源码和demo" class="headerlink" title="七、源码和demo"></a>七、源码和demo</h2><p><a href="https://github.com/wall-wxk/blogDemo/blob/master/2017/02/05/getStyle.html" target="_blank" rel="external">源码地址</a>：<code>https://github.com/wall-wxk/blogDemo/blob/master/2017/02/05/getStyle.html</code><br><a href="https://wall-wxk.github.io/blogDemo/2017/02/05/getStyle.html">demo</a>：<code>https://wall-wxk.github.io/blogDemo/2017/02/05/getStyle.html</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/4118463-ff57104dab5b90e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p> 谢谢@<a href="http://www.jianshu.com/u/a3187c2973b1" target="_blank" rel="external">烟雨雾岚</a> 的提醒的新思路：canvas截图+Js获取图片某点颜色，这样可以完美解决所有的问题。</p>
</div><div class="tags"><a href="/tags/微信/">微信</a></div><div class="post-nav"><a href="/2017/02/07/gfw/" class="pre">福利贴-教你如何优雅地科学上网</a><a href="/2017/01/22/wx-lazyMan/" class="next">微信面试题-LazyMan的深入解析和实现</a></div><div data-thread-key="2017/02/05/wx-backgroundColor/" data-title="微信面试题-获取元素的最终background-color" data-url="https://wall-wxk.github.io/2017/02/05/wx-backgroundColor/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/02/05/wx-backgroundColor/" data-title="微信面试题-获取元素的最终background-color" data-url="https://wall-wxk.github.io/2017/02/05/wx-backgroundColor/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/面试题/">面试题</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/CSS/">CSS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/小作品/">小作品</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/模块化编程/">模块化编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/面试题/">面试题</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">其他</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/gfw/" style="font-size: 15px;">gfw</a> <a href="/tags/loadCss/" style="font-size: 15px;">loadCss</a> <a href="/tags/Sea-js/" style="font-size: 15px;">Sea.js</a> <a href="/tags/微信/" style="font-size: 15px;">微信</a> <a href="/tags/localStorage/" style="font-size: 15px;">localStorage</a> <a href="/tags/IIFE/" style="font-size: 15px;">IIFE</a> <a href="/tags/sniffer-js/" style="font-size: 15px;">sniffer.js</a> <a href="/tags/throttle/" style="font-size: 15px;">throttle</a> <a href="/tags/debounce/" style="font-size: 15px;">debounce</a> <a href="/tags/lazyMan/" style="font-size: 15px;">lazyMan</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/15/throttleAndDebounce/">JavaScript函数节流和函数防抖之间的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/14/sniffer/">JavaScript嗅探执行神器-sniffer.js，你值得拥有！</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/13/moduleJs-IIFE/">javascript模块化编程-详解立即执行函数表达式IIFE</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/07/gfw/">福利贴-教你如何优雅地科学上网</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/05/wx-backgroundColor/">微信面试题-获取元素的最终background-color</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/22/wx-lazyMan/">微信面试题-LazyMan的深入解析和实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/localStorage/">localStorage的黑科技-js和css缓存机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/loadCss/">动态加载css方法实现和深入解析</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:582104384@qq.com" target="_blank" class="fa fa-email"> </a><a href="undefined" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/wall-wxk" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">wall</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var duoshuoQuery = {short_name:'wall-wxk'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script></body></html>